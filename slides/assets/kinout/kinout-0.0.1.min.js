/**
 *
 *
 * @copyright  2011 TapQuo Inc (c)
 * @license    http://www.github.com/soyjavi/kinout/blob/master/README.md
 * @version    0.0.1
 * @link       http://www.github.com/soyjavi/kinout
 *
 * @author     Javier Jimenez Villar <javi@tapquo.com> || @soyjavi
 */

var KINOUT=KINOUT||{};KINOUT.VERSION="0.1";KINOUT.Core=function(c){return{init:function(b){c.View.init(b);c.Events.init();c.Url.read()}}}(KINOUT);KINOUT.Dom=function(){var c=function(a){return document.querySelector(a)},b=function(a){var e=[];try{e=Array.prototype.slice.call(document.querySelectorAll(a))}catch(f){console.error(f)}return e};return{addClass:function(a,e){var f=b(a);for(index in f){var g=f[index];g.className.match(RegExp("(\\s|^)"+e+"(\\s|$)"))||(g.className+=" "+e)}},removeClass:function(a,e){var f=b(a);for(index in f){var g=f[index];if(g.className.match(RegExp("(\\s|^)"+e+"(\\s|$)")))g.className=g.className.replace(RegExp("(\\s|^)"+
e+"(\\s|$)")," ")}},append:function(a,e){var f=c(a);if(f)f.innerHTML+=e},prepend:function(a,e){var f=c(a);if(f)f.innerHTML=e+f.innerHTML},get:c}}(KINOUT);KINOUT.Editor=function(){return{}}(KINOUT);KINOUT.Events=function(c){var b={KEYDOWN:"keydown",CLICK:"click",TOUCH:"touchstart",HASHCHANGE:"hashchange"},a={LEFT:"left",RIGHT:"right",UP:"up",DOWN:"down"},e=function(d){if(d.keyCode>=37&&d.keyCode<=40){switch(d.keyCode){case 37:c.Router.direction(a.LEFT);break;case 39:c.Router.direction(a.RIGHT);break;case 38:c.Router.direction(a.UP);break;case 40:c.Router.direction(a.DOWN)}d.preventDefault()}},f=function(d){if(d.touches.length==1){d.preventDefault();i({x:d.touches[0].clientX,y:d.touches[0].clientY})}},
g=function(d){d.preventDefault();i({x:d.clientX,y:d.clientY})},h=function(){c.Url.read()},i=function(d){var j=window.innerWidth*0.3,k=window.innerHeight*0.3;if(d.x<j)c.Router.direction(a.LEFT);else if(d.x>window.innerWidth-j)c.Router.direction(a.RIGHT);else if(d.y<k)c.Router.direction(a.UP);else d.y>window.innerHeight-k&&c.Router.direction(a.DOWN)};return{init:function(){document.addEventListener(b.KEYDOWN,e,false);document.addEventListener(b.TOUCH,f,false);document.addEventListener(b.CLICK,g,false);
window.addEventListener(b.HASHCHANGE,h,false)}}}(KINOUT);KINOUT.Router=function(c){var b={};return{direction:function(a){b=c.View.index();switch(a){case "left":b.horizontal--;c.View.slide(b.horizontal,0);break;case "right":b.horizontal++;c.View.slide(b.horizontal,0);break;case "up":b.vertical--;c.View.slide(b.horizontal,b.vertical);break;case "down":b.vertical++;c.View.slide(b.horizontal,b.vertical)}}}}(KINOUT);KINOUT.Url=function(c){return{read:function(){var b=window.location.hash.slice(2).split("/"),a=b[0]?parseInt(b[0]):0;b=b[1]?parseInt(b[1]):0;c.View.slide(a,b)},write:function(b,a){var e="/";if(b>0||a>0)e+=b;if(a>0)e+="/"+a;window.location.hash=e}}}(KINOUT);KINOUT.View=function(c,b){var a={horizontal:0,vertical:0},e={GLOW:'<div class="glow"></div>',COPYRIGHT:''},f=function(g,h){var i=Array.prototype.slice.call(document.querySelectorAll(g));if(i.length){h=Math.max(Math.min(h,i.length-1),0);i[h].setAttribute("class","present");i.slice(0,h).map(function(d){d.setAttribute("class","past")});i.slice(h+1).map(function(d){d.setAttribute("class","future")})}else h=
0;return h};return{init:function(g){g.template&&c.Dom.addClass(".kinout",g.template);c.Dom.prepend("body",e.GLOW);c.Dom.append("body",e.COPYRIGHT);g=navigator.userAgent.match(/(iPhone|iPad|iPod|Android)/i)?"Tap to navigate":"Navigate via keyboard";c.Dom.append("section:first-child",'<h4 class="transparent">('+g+")</h4>")},slide:function(g,h){a.horizontal=g===b?a.horizontal:g;a.vertical=h===b?a.vertical:h;a.horizontal=f(".kinout>section",a.horizontal);a.vertical=f("section.present>section",a.vertical);
c.Url.write(a.horizontal,a.vertical)},index:function(){return a}}}(KINOUT);KINOUT.View.Markup=function(){return{}}(KINOUT);
